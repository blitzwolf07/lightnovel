<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Novel</title>

    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
</head>
<body>
    <svg width="100%" height="100%" style="position:absolute; top:0; left:0; pointer-events: none; z-index: -1;">
        <path id="semiCirclePath" d="M200,400 A300,300 0 0,1 1000,400" fill="none" stroke="none"/>
    </svg>

    <main>
        <nav class="navbar navbar-expand-lg bg-body-tertiary shadow-lg fixed-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Light Novel</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <div class="navbar-nav">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                        <a class="nav-link" href="#">About</a>
                    </div>
                </div>
            </div>
        </nav>
    </main>

    <div class="header" style="visibility: hidden;">
         <h1 id="name"></h1>
         <div id="gallery"></div>
    </div>
    <section class="slider-section">
        <div class="wheel">
          <div class="wheel__card" id="InuiSachi">
            <img src="img/InuiSachi/icon.png" />
          </div>
          <div class="wheel__card" id="ShiinaYuzuki">
            <img src="img/ShiinaYuzuki/icon.png" />
          </div>
        </div>
      </section>
      
      </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Flip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>

    <script>
        gsap.registerPlugin(ScrollTrigger, Flip, Draggable);

        let wheel = document.querySelector(".wheel"),
        images = gsap.utils.toArray(".wheel__card"),
        cards = gsap.utils.toArray(".wheel__card"),
        header = document.querySelector(".header"),
        currentCard; // keep track of last clicked card so we can put it back
        
        let cardNo = document.querySelectorAll('.wheel__card').length;
        let circle = 360 / cardNo;

        function setup() {
        let radius = wheel.offsetWidth / 2,
            center = radius,
            slice = circle / images.length,
            DEG2RAD = Math.PI / 180;
        gsap.set(images, {
            x: i => center + radius * Math.sin(i * slice * DEG2RAD),
            y: i => center - radius * Math.cos(i * slice * DEG2RAD),
            rotation: i => i * slice,
            xPercent: -50,
            yPercent: -50
        });
        }

        setup();

        window.addEventListener("resize", setup);

        gsap.to(wheel, {
        rotation: -90,
        ease: "none",
        duration: images.length,
        scrollTrigger: {
            start: 0,
            end: () => document.documentElement.scrollHeight - window.innerHeight, // Dynamically calculate the end value
            scrub: 1
        }
        });

        Draggable.create(wheel, {
            type: "rotation",
            inertia: true,
            onDrag: function () {
                gsap.to(wheel, { rotation: this.rotation });
            }
        });

        cards.forEach(card => card.addEventListener("click", onClickCard));

        header.addEventListener("click", closeCurrentCard);

        function formatName(id) {
            // Convert the id to a properly formatted name
            return id.replace(/([A-Z])/g, ' $1') // Add space before uppercase letters
                     .replace(/^./, str => str.toUpperCase()); // Capitalize the first letter
        }

        const characterImages = {
            InuiSachi: [
                { src: "img/InuiSachi/default.png", type: "default" },
                { src: "img/InuiSachi/alt.png", type: "alt" },
                { src: "img/InuiSachi/chibi.png", type: "chibi" }
            ],
            ShiinaYuzuki: [
                { src: "img/ShiinaYuzuki/default.png", type: "default" },
                { src: "img/ShiinaYuzuki/alt.png", type: "alt" },
                { src: "img/ShiinaYuzuki/chibi.png", type: "chibi" }
            ]
        };

        const characterStories = {
            InuiSachi: {
                title: "About Inui Sachi",
                content: `A cheerful and energetic girl who loves gaming and technology. Despite her playful nature, she takes her responsibilities seriously and always strives to help others.

                As a prominent member of the gaming club, she's known for her strategic thinking and quick reflexes. Her favorite games are RPGs and puzzle games, though she's skilled at most genres.

                Behind her bright smile lies a deep understanding of both games and people, making her a natural leader and friend to many. Her room is filled with gaming memorabilia and tech gadgets, reflecting her passionate interests.

                As Ren's non-blood-related sister, she maintains a close bond with him. While she may occasionally act bratty towards her brother, their relationship is built on genuine care and understanding. She balances her love for gaming with excellent academic performance, showing remarkable dedication to both her hobbies and studies.

                Whether she's helping newcomers learn the basics or competing in tournaments, Sachi approaches everything with enthusiasm and determination.`
            },
            ShiinaYuzuki: {
                title: "About Shiina Yuzuki",
                content: `A dignified and composed student council president from a prestigious family. As an upperclassman to Sachi, she maintains an air of elegance and sophistication that befits her position.

                Born into a strict and affluent household, Yuzuki dedicates herself to upholding high standards in both academics and leadership, driven by her desire to make her father proud. Her composed demeanor and graceful presence command respect among her peers.

                Despite her polished exterior, Yuzuki occasionally yearns for the simple joys of ordinary student life. She finds herself drawn to the carefree nature of her classmates, particularly Sachi's authentic and spirited approach to life.

                As student council president, she expertly balances maintaining the school's order with understanding her fellow students' needs. Though bound by expectations, she harbors dreams of experiencing life beyond the constraints of her family's reputation.

                Behind her cool facade lies a young woman learning to navigate between duty and personal desires, finding small moments of freedom in her daily responsibilities.`
            }
        };

        // Preload all images when the page loads
        const preloadedImages = {};
        function preloadImages() {
            Object.entries(characterImages).forEach(([character, images]) => {
                preloadedImages[character] = images.map(image => {
                    const img = new Image();
                    img.src = image.src;
                    img.className = image.type;
                    return img;
                });
            });
        }
        // Start preloading immediately
        preloadImages();

        function closeCurrentCard() {
            if (currentCard) {
                const gallery = header.querySelector("#gallery");
                gallery.innerHTML = '';
                
                // Remove story section
                const storyDiv = header.querySelector(".character-story");
                if (storyDiv) {
                    storyDiv.remove();
                }
                
                let img = header.querySelector("img:not([id='gallery'] *)"),
                    state = Flip.getState(img);
                currentCard.appendChild(img);
                Flip.from(state, {
                    ease: "power1.inOut",
                    scale: true,
                    duration: 0.4
                });
                
                currentCard = null;
                header.style.visibility = "hidden";
                header.style.pointerEvents = "none";
                header.querySelector("#name").textContent = "";
                // Reset theme
                header.dataset.theme = "";
            }
        }

        function onClickCard(e) {
            let card = e.target.closest('.wheel__card');
            if (!card) return;
            
            let image = card.querySelector("img");
            if (!image) return;

            if (card !== currentCard) {
                closeCurrentCard();
                currentCard = card;
                
                const nameEl = header.querySelector("#name");
                const state = Flip.getState(image);
                
                nameEl.textContent = formatName(card.id);
                nameEl.insertAdjacentElement('afterend', image);
                
                Flip.from(state, {
                    duration: 0.4,
                    scale: true,
                    ease: "power1.inOut"
                });
                
                header.style.visibility = "visible";
                header.style.pointerEvents = "auto";
                
                // Set theme based on character
                const isLight = card.id === "ShiinaYuzuki";
                header.dataset.theme = isLight ? "light" : "dark";
                header.style.backgroundColor = isLight ? "#F9F1FE" : "#1d1e22";

                // Update gallery
                const gallery = header.querySelector("#gallery");
                gallery.innerHTML = "";
                
                const preloadedImagesForCharacter = preloadedImages[card.id] || [];
                if (preloadedImagesForCharacter.length) {
                    const fragment = document.createDocumentFragment();
                    preloadedImagesForCharacter.forEach(img => {
                        const clonedImg = img.cloneNode();
                        clonedImg.className = img.className;
                        fragment.appendChild(clonedImg);
                    });
                    gallery.appendChild(fragment);
                }

                // Update character story
                let storyDiv = header.querySelector(".character-story");
                if (!storyDiv) {
                    storyDiv = document.createElement("div");
                    storyDiv.className = "character-story";
                    header.appendChild(storyDiv);
                }

                const story = characterStories[card.id];
                storyDiv.innerHTML = `
                    <h2>${story.title}</h2>
                    <p>${story.content.split('\n\n').join('</p><p>')}</p>
                `;
            } else {
                closeCurrentCard();
            }
        }
    </script>
</body>
</html>