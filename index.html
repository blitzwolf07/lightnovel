<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Novel</title>

    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
</head>
<body>
    <svg width="100%" height="100%" style="position:absolute; top:0; left:0; pointer-events: none; z-index: -1;">
        <path id="semiCirclePath" d="M200,400 A300,300 0 0,1 1000,400" fill="none" stroke="none"/>
    </svg>

    <main>
        <nav class="navbar navbar-expand-lg bg-body-tertiary shadow-lg fixed-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Light Novel</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <div class="navbar-nav">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                        <a class="nav-link" href="#">About</a>
                    </div>
                </div>
            </div>
        </nav>
    </main>

    <div class="header" style="visibility: hidden;">
         <h1 id="name"></h1>
         <div id="gallery"></div>
      </div>
      <section class="slider-section">
        <div class="wheel">
          <div class="wheel__card" id="InuiSachi">
            <img src="img/InuiSachi/icon.png" />
          </div>
          <div class="wheel__card" id="ShiinaYuzuki">
            <img src="img/ShiinaYuzuki/icon.png" />
          </div>
        </div>
      </section>
      
      </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Flip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>

    <script>
        gsap.registerPlugin(ScrollTrigger, Flip, Draggable);

        let wheel = document.querySelector(".wheel"),
        images = gsap.utils.toArray(".wheel__card"),
        cards = gsap.utils.toArray(".wheel__card"),
        header = document.querySelector(".header"),
        currentCard; // keep track of last clicked card so we can put it back
        
        let cardNo = document.querySelectorAll('.wheel__card').length;
        let circle = 360 / cardNo;

        function setup() {
        let radius = wheel.offsetWidth / 2,
            center = radius,
            slice = circle / images.length,
            DEG2RAD = Math.PI / 180;
        gsap.set(images, {
            x: i => center + radius * Math.sin(i * slice * DEG2RAD),
            y: i => center - radius * Math.cos(i * slice * DEG2RAD),
            rotation: i => i * slice,
            xPercent: -50,
            yPercent: -50
        });
        }

        setup();

        window.addEventListener("resize", setup);

        gsap.to(wheel, {
        rotation: -90,
        ease: "none",
        duration: images.length,
        scrollTrigger: {
            start: 0,
            end: () => document.documentElement.scrollHeight - window.innerHeight, // Dynamically calculate the end value
            scrub: 1
        }
        });

        Draggable.create(wheel, {
            type: "rotation",
            inertia: true,
            onDrag: function () {
                gsap.to(wheel, { rotation: this.rotation });
            }
        });

        cards.forEach(card => card.addEventListener("click", onClickCard));

        header.addEventListener("click", closeCurrentCard);

        function formatName(id) {
            // Convert the id to a properly formatted name
            return id.replace(/([A-Z])/g, ' $1') // Add space before uppercase letters
                     .replace(/^./, str => str.toUpperCase()); // Capitalize the first letter
        }

        const characterImages = {
            InuiSachi: [
                "img/InuiSachi/default.png",
                "img/InuiSachi/alt.png",
                "img/InuiSachi/chibi.png"
            ],
            ShiinaYuzuki: [
                "img/ShiinaYuzuki/default.png",
                "img/ShiinaYuzuki/alt.png",
                "img/ShiinaYuzuki/chibi.png"
            ]
        };

        function closeCurrentCard() {
        if (currentCard) {
            let img = header.querySelector("img"),
            state = Flip.getState(img);
            currentCard.appendChild(img);
            Flip.from(state, {
            ease: "power1.inOut",
            scale: true
            });
            currentCard = null;
            header.style.visibility = "hidden"; // Hide header when no image is selected
            header.querySelector("#name").textContent = "";
            header.querySelector("#gallery").innerHTML = "";
        }
        }

        function onClickCard(e) {
        let card = e.target,
            image = card.querySelector("img");
        if (card !== currentCard) {
            closeCurrentCard();
            currentCard = card;
            let state = Flip.getState(image);
            header.appendChild(image);
            Flip.from(state, {
            duration: 0.6,
            scale: true,
            ease: "power1.inOut"
            });
            header.style.visibility = "visible";

            let formattedName = formatName(card.id);
                header.querySelector("#name").textContent = formattedName;

            if (card.id === "ShiinaYuzuki") {
                header.style.backgroundColor = "#F9F1FE";
            } else if (card.id === "InuiSachi") {
                header.style.backgroundColor = "#1d1e22";
            } else {
                header.style.backgroundColor = ""; // fallback/default
            }

            const gallery = header.querySelector("#gallery");
                gallery.innerHTML = ""; // Clear previous
                (characterImages[card.id] || []).forEach(src => {
                    const img = document.createElement("img");
                    img.src = src;
                    img.style.width = "120px";
                    img.style.margin = "10px";
                    gallery.appendChild(img);
                });
        } else {
            closeCurrentCard();
        }
        }
    </script>
</body>
</html>